{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the ConnectVIP application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "The user's username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "isVerified": {
          "type": "boolean",
          "description": "Indicates if the user is a verified user (e.g., famous user)."
        },
        "vipSubscriptionId": {
          "type": "string",
          "description": "Reference to the VIPSubscription. (Relationship: User 1:1 VIPSubscription)"
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a message sent between users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Message entity."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to the User who sent the message. (Relationship: User 1:N Message)"
        },
        "recipientId": {
          "type": "string",
          "description": "Reference to the User who is the recipient of the message. (Relationship: User 1:N Message)"
        },
        "content": {
          "type": "string",
          "description": "The content of the message."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of when the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "senderId",
        "recipientId",
        "content",
        "timestamp"
      ]
    },
    "VIPSubscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VIPSubscription",
      "type": "object",
      "description": "Represents a VIP subscription for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the VIP Subscription."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns this subscription. (Relationship: User 1:1 VIPSubscription)"
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the subscription.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the subscription.",
          "format": "date-time"
        },
        "subscriptionType": {
          "type": "string",
          "description": "The type of subscription (e.g., 5-day premium)."
        },
        "price": {
          "type": "number",
          "description": "The price of the subscription."
        }
      },
      "required": [
        "id",
        "userId",
        "startDate",
        "endDate",
        "subscriptionType",
        "price"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Only the authenticated user can read/write their data.  `userId` must match `request.auth.uid`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores messages for each user. `senderId` and `recipientId` inside each message document are used directly in the security rules. The `userId` in the path must match either `message.senderId` or `message.recipientId` for write access. The `userId` in the path must match either `message.senderId` or `message.recipientId` for read access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "messageId",
              "description": "The unique ID of the message."
            }
          ]
        }
      },
      {
        "path": "/vip_subscriptions/{vipSubscriptionId}",
        "definition": {
          "entityName": "VIPSubscription",
          "schema": {
            "$ref": "#/backend/entities/VIPSubscription"
          },
          "description": "Stores details about VIP subscriptions. The `userId` field establishes a relationship with the user.",
          "params": [
            {
              "name": "vipSubscriptionId",
              "description": "The unique ID of the VIP subscription."
            }
          ]
        }
      },
      {
        "path": "/roles_verified/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to mark users as verified. Existence of document indicates verified status.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the verified user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support a messaging application with VIP subscription features, focusing on security, scalability, and maintainability, with an emphasis on authorization independence.\n\n*   **Authorization Independence:** Achieved through denormalization. For instance, access to messages within a user's message threads does not require fetching the user's document to check ownership. Instead, the `senderId` and `recipientId` within each message document are used directly in the security rules.\n*   **QAPs Support:** Secure `list` operations are supported by segregating data based on ownership. Path-based ownership `/users/{userId}/messages/{messageId}` ensures that only the user (or someone with appropriate admin privileges) can list messages under their own user ID. The VIP subscription status does not affect the message structure, preventing filter-based rules.\n*   **User Data (`/users/{userId}`):** Stores user profiles. The structure supports secure access rules where only the authenticated user can read/write their data.\n*   **Messages (`/users/{userId}/messages/{messageId}`):** Stores messages for each user. The path-based structure enables easy querying of messages associated with a specific user and simplifies security rules for message access.\n*   **VIP Subscriptions (`/vip_subscriptions/{vipSubscriptionId}`):**  Stores details about VIP subscriptions.  This collection allows admins to manage the subscriptions. The `userId` field establishes a relationship with the user.\n*   **Verified Users (`/roles_verified/{userId}`):** A dedicated collection stores the IDs of verified users. The existence of a document in this collection grants verified user status, enabling simplified security rules (existence check instead of complex data checks).\n\nThis design facilitates a clear and secure permission model using Firestore security rules, avoiding complex `get()` calls and ensuring data integrity."
  }
}